<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>2026 è·¨å¹´èˆå° Â· ç‚¹å‡»è¿›å…¥</title>
<style>
html, body {
    margin: 0;
    padding: 0;
    background: black;
    overflow: hidden;
}
canvas { display: block; }
</style>
</head>
<body>

<canvas id="canvas"></canvas>
<audio id="bgm" src="music.mp3" loop></audio>

<script>
/* ================= åŸºç¡€è®¾ç½® ================= */
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;
const bgm = document.getElementById("bgm");

/* ================= å…¨å±€çŠ¶æ€ ================= */
let started = false;

/* ================= çƒŸèŠ±ç±»å‹ =================
0 æ™®é€š
1 èŠèŠ±
2 â¤ï¸ å¿ƒå½¢
3 ğŸŒ€ èºæ—‹
============================================ */

/* ================= çƒŸèŠ±ç±» ================= */
class Firework {
    constructor(type = 0, intense = false) {
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * canvas.height * 0.6;
        this.type = type;
        this.color = intense ? "gold" : `hsl(${Math.random()*360},100%,60%)`;
        this.particles = [];
        this.create();
    }

    create() {
        const count = [90, 140, 120, 160][this.type];
        for (let i = 0; i < count; i++) {

            if (this.type === 2) {
                const t = i / count * Math.PI * 2;
                const x = 16 * Math.pow(Math.sin(t), 3);
                const y = 13 * Math.cos(t)
                        - 5 * Math.cos(2*t)
                        - 2 * Math.cos(3*t)
                        - Math.cos(4*t);
                this.particles.push({
                    x: this.x,
                    y: this.y,
                    vx: x * 0.15,
                    vy: -y * 0.15,
                    life: 140
                });
                continue;
            }

            let angle = Math.random() * Math.PI * 2;
            let speed = Math.random() * 5 + 1;
            if (this.type === 3) angle = i / count * Math.PI * 6;

            this.particles.push({
                x: this.x,
                y: this.y,
                vx: Math.cos(angle) * speed,
                vy: Math.sin(angle) * speed,
                angle,
                life: 120
            });
        }
    }

    update() {
        this.particles.forEach(p => {
            if (this.type === 3) {
                p.angle += 0.12;
                p.vx = Math.cos(p.angle) * 2;
                p.vy = Math.sin(p.angle) * 2;
            }
            p.x += p.vx;
            p.y += p.vy;
            p.vy += 0.03;
            p.life--;
        });
    }

    draw() {
        ctx.fillStyle = this.color;
        this.particles.forEach(p => {
            if (p.life > 0) ctx.fillRect(p.x, p.y, 2, 2);
        });
    }
}

/* ================= æ–‡å­—ç²’å­ ================= */
let textParticles = [];

function createText(text, fontSize, color="white", glow=false) {
    textParticles = [];
    ctx.clearRect(0,0,canvas.width,canvas.height);

    ctx.font = `bold ${fontSize}px sans-serif`;
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillStyle = color;

    if (glow) {
        ctx.shadowColor = color;
        ctx.shadowBlur = 30;
    }

    ctx.fillText(text, canvas.width/2, canvas.height/2);
    ctx.shadowBlur = 0;

    const img = ctx.getImageData(0,0,canvas.width,canvas.height);
    for (let y=0;y<canvas.height;y+=6)
        for (let x=0;x<canvas.width;x+=6){
            const i=(y*canvas.width+x)*4;
            if(img.data[i+3]>150){
                textParticles.push({
                    x: Math.random()*canvas.width,
                    y: Math.random()*canvas.height,
                    tx:x, ty:y, vx:0, vy:0
                });
            }
        }
}

function updateText(){
    textParticles.forEach(p=>{
        p.vx+=(p.tx-p.x)*0.02;
        p.vy+=(p.ty-p.y)*0.02;
        p.vx*=0.75; p.vy*=0.75;
        p.x+=p.vx; p.y+=p.vy;
    });
}

function drawText(){
    ctx.fillStyle="white";
    textParticles.forEach(p=>ctx.fillRect(p.x,p.y,2,2));
}

/* ================= èˆå°è„šæœ¬ ================= */
const script = [
    "5","4","3","2","1",
    "2026","æ–°å¹´å¿«ä¹",
    "æ„¿æˆ‘ä»¬","æ–°çš„ä¸€å¹´",
    "å¥½è¿ +1","å¥åº· +1",
    "è´¢å¯Œ +âˆ","å¹³å®‰å–œä¹","ä¸‡äº‹é¡ºæ„"
];

let index = 0;
let fireworks = [];
let currentText = script[0];
let endingShown = false;

function allowedTypesByText(text) {
    if (["5","4","3","2","1"].includes(text)) return [0,1];
    if (text === "2026" || text === "æ–°å¹´å¿«ä¹") return [0,1,2];
    if (["è´¢å¯Œ +âˆ","å¹³å®‰å–œä¹","ä¸‡äº‹é¡ºæ„"].includes(text)) return [0,1,3];
    return [0,1];
}

function pickType(list){
    return list[Math.floor(Math.random()*list.length)];
}

function stageNext() {
    if (!started) return;

    if (index < script.length) {
        currentText = script[index++];
        const key = (currentText === "2026" || currentText === "æ–°å¹´å¿«ä¹");

        createText(currentText, 200, key ? "gold" : "white", key);

        const boom = ["5","4","3","2","1"].includes(currentText) ? 10 : 4;
        const types = allowedTypesByText(currentText);
        for (let i = 0; i < boom; i++) {
            fireworks.push(new Firework(pickType(types), key));
        }

        // â­ å…³é”®ï¼šåŒºåˆ†æ’­æ”¾é€Ÿåº¦
        const isCountdown = ["5","4","3","2","1"].includes(currentText);
        const delay = isCountdown ? 1200 : 2500;
        setTimeout(stageNext, delay);
        return;
    }

    if (!endingShown) {
        endingShown = true;
        currentText = "ending";

        createText(
            "ç‹æ„çˆ¸çˆ¸åœ¨æ­¤ç¥æ„¿å¾å„¿èŒƒå…ˆè¿›å…ƒæ—¦å¿«ä¹",
            50,
            "white",
            false
        );
    }
}

/* ================= ä¸»åŠ¨ç”» ================= */
function animate() {
    ctx.fillStyle="rgba(0,0,0,0.25)";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    if (!started) {
        createText("è¿›å…¥", 200, "white", true);
        drawText();
        requestAnimationFrame(animate);
        return;
    }

    if (Math.random() < 0.04) {
        fireworks.push(new Firework(
            pickType(allowedTypesByText(currentText))
        ));
    }

    fireworks.forEach((f,i)=>{
        f.update(); f.draw();
        if(f.particles.every(p=>p.life<=0)) fireworks.splice(i,1);
    });

    updateText();
    drawText();
    requestAnimationFrame(animate);
}

/* ================= å¯åŠ¨ ================= */
animate();

/* ğŸŸ¢ ç‚¹å‡»è¿›å…¥ */
document.body.addEventListener("click", () => {
    if (started) return;
    started = true;
    bgm.play();
    stageNext();
});

window.onresize=()=>{canvas.width=innerWidth;canvas.height=innerHeight};
</script>

</body>
</html>

